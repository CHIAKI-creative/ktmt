<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>·ª®ng D·ª•ng Ki·ªÉm Tra Tr·∫Øc Nghi·ªám</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">

    <div class="container py-5">
        <header class="text-center mb-5">
            <h1 class="display-5 fw-bold text-primary">üìù ·ª®ng D·ª•ng Ki·ªÉm Tra Tr·∫Øc Nghi·ªám</h1>
            <p class="lead text-muted">Ki·ªÉm tra ki·∫øn th·ª©c c·ªßa b·∫°n m·ªôt c√°ch nhanh ch√≥ng v√† ch√≠nh x√°c.</p>
        </header>

        <div id="setup-view" class="card shadow-lg p-4 mb-5 bg-white rounded-3">
            <div class="card-body">
                <h2 class="card-title text-center text-secondary mb-4">Thi·∫øt L·∫≠p B√†i Ki·ªÉm Tra</h2>
                <div class="row justify-content-center">
                    <div class="col-md-6">
                            <label for="num-questions-input" class="form-label fw-bold">Nh·∫≠p s·ªë c√¢u h·ªèi b·∫°n mu·ªën l√†m:</label>
                            <input type="number" id="num-questions-input" class="form-control form-control-lg mb-3" min="1" required placeholder="V√≠ d·ª•: 5">

                            <div id="question-limit-feedback" class="text-danger mb-3 d-none"></div>

                            <button id="start-quiz-btn" class="btn btn-primary btn-lg w-100 mt-3" disabled>B·∫Øt ƒê·∫ßu Ki·ªÉm Tra</button>
                            <small class="text-muted d-block mt-2 text-center" id="total-questions-info"></small> 
                    </div>
                </div>
            </div>
        </div>

        <div id="quiz-view" class="card shadow-lg p-4 mb-5 bg-white rounded-3 d-none">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="card-title text-primary mb-0">C√¢u H·ªèi <span id="current-question-number"></span>/<span id="total-questions-display"></span></h2>
                    <span id="progress-text" class="fw-bold text-muted">0%</span>
                </div>
                
                <div class="progress mb-4" role="progressbar" aria-label="Ti·∫øn tr√¨nh" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar bg-info" style="width: 0%" id="quiz-progress-bar"></div>
                </div>

                <h3 class="mb-4" id="question-text"></h3>
                
                <div id="answer-options" class="d-grid gap-3">
                    </div>

                <div id="feedback" class="mt-4 p-3 rounded-3 text-center d-none"></div>

                <button id="next-question-btn" class="btn btn-success btn-lg w-100 mt-4" disabled>Ti·∫øp T·ª•c ‚û°Ô∏è</button>
            </div>
        </div>

        <div id="result-view" class="card shadow-lg p-4 mb-5 bg-white rounded-3 d-none">
            <div class="card-body">
                <h2 class="card-title text-center mb-4">üéâ K·∫øt Qu·∫£ B√†i Ki·ªÉm Tra üéâ</h2>
                <div class="alert alert-info text-center" role="alert">
                    B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng **<span id="correct-answers-count"></span>** tr√™n t·ªïng s·ªë **<span id="total-questions-result"></span>** c√¢u h·ªèi.
                    <br>
                    ƒêi·ªÉm s·ªë c·ªßa b·∫°n l√†: <strong class="display-6" id="final-score"></strong>
                </div>

                <h3 class="mt-4 mb-3 text-secondary">B·∫£ng T·ªïng H·ª£p Chi Ti·∫øt</h3>
                <div class="table-responsive">
                    <table class="table table-bordered table-striped align-middle" id="result-table">
                        <thead>
                            <tr class="table-primary">
                                <th scope="col"># C√¢u</th>
                                <th scope="col">C√¢u H·ªèi</th>
                                <th scope="col">ƒê√°p √Ån C·ªßa B·∫°n</th>
                                <th scope="col">ƒê√°p √Ån ƒê√∫ng</th>
                                <th scope="col">K·∫øt Qu·∫£</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>

                <button id="restart-quiz-btn" class="btn btn-warning btn-lg w-100 mt-4">
                    <i class="bi bi-arrow-counterclockwise"></i> Tr·ªü L·∫°i Trang Ch·ªß
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="script.js"></script>
   <script>
        // M√É JAVASCRIPT ƒê∆Ø·ª¢C ƒê·∫∂T TR·ª∞C TI·∫æP ·ªû ƒê√ÇY HO·∫∂C TRONG FILE SCRIPT.JS
        // T√¥i s·∫Ω ƒë·∫∑t m√£ JS ngay d∆∞·ªõi ƒë√¢y ƒë·ªÉ b·∫°n ti·ªán copy-paste v√† ch·∫°y th·ª≠.
        

        let selectedQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = []; // L∆∞u tr·ªØ {question: "", yourAnswer: "", correctAnswer: "", isCorrect: bool}
        let totalQuestionsToAsk = 0;
        let answeredCurrentQuestion = false;

        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);

        // --- DOM Elements ---
        const setupView = $('#setup-view');
        const quizView = $('#quiz-view');
        const resultView = $('#result-view');
        const numQuestionsInput = $('#num-questions-input'); // Thay th·∫ø select b·∫±ng input
        const questionLimitFeedback = $('#question-limit-feedback'); // Th√™m feedback l·ªói
        const startQuizBtn = $('#start-quiz-btn');
        const totalQuestionsInfo = $('#total-questions-info');
        const currentQuestionNumberDisplay = $('#current-question-number');
        const totalQuestionsDisplay = $('#total-questions-display');
        const questionTextDisplay = $('#question-text');
        const answerOptionsContainer = $('#answer-options');
        const feedbackDisplay = $('#feedback');
        const nextQuestionBtn = $('#next-question-btn');
        const quizProgressBar = $('#quiz-progress-bar');
        const progressText = $('#progress-text');
        const restartQuizBtn = $('#restart-quiz-btn');

        // --- H√†m Ti·ªán √çch ---

        // Tr·ªôn m·∫£ng (Fisher-Yates)
        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        // --- Giao Di·ªán 1: Thi·∫øt L·∫≠p ---

        // --- Giao Di·ªán 1: Thi·∫øt L·∫≠p ---

        function setupInitialView() {
            // L·∫•y t·ªïng s·ªë c√¢u h·ªèi c√≥ s·∫µn
            const totalAvailable = quizData.length;
            totalQuestionsInfo.textContent = `(C√≥ t·ªïng c·ªông ${totalAvailable} c√¢u h·ªèi s·∫µn c√≥)`;

            // ƒê·∫∑t gi√° tr·ªã max cho input
            numQuestionsInput.max = totalAvailable;

            // K√≠ch ho·∫°t n√∫t B·∫Øt ƒê·∫ßu khi c√≥ input h·ª£p l·ªá
            numQuestionsInput.addEventListener('input', () => {
                const value = parseInt(numQuestionsInput.value);
                
                // Ki·ªÉm tra v√† hi·ªÉn th·ªã feedback
                if (isNaN(value) || value <= 0) {
                    startQuizBtn.disabled = true;
                    questionLimitFeedback.classList.add('d-none');
                    totalQuestionsToAsk = 0;
                } else if (value > totalAvailable) {
                    startQuizBtn.disabled = true;
                    questionLimitFeedback.textContent = `‚ö†Ô∏è Ch·ªâ c√≥ t·ªëi ƒëa ${totalAvailable} c√¢u h·ªèi.`;
                    questionLimitFeedback.classList.remove('d-none');
                    totalQuestionsToAsk = 0;
                } else {
                    // H·ª£p l·ªá
                    startQuizBtn.disabled = false;
                    questionLimitFeedback.classList.add('d-none');
                    totalQuestionsToAsk = value; // G√°n s·ªë c√¢u h·ªèi ng∆∞·ªùi d√πng nh·∫≠p
                }
            });

            startQuizBtn.addEventListener('click', startQuiz);
            restartQuizBtn.addEventListener('click', resetQuiz);

            // ƒê·∫£m b·∫£o ch·ªâ hi·ªÉn th·ªã Giao di·ªán Thi·∫øt L·∫≠p
            showView('setup');
        }

        // ... (c√°c h√†m kh√°c gi·ªØ nguy√™n)

        function resetQuiz() {
            // Quay l·∫°i tr·∫°ng th√°i ban ƒë·∫ßu
            showView('setup');
            numQuestionsInput.value = ""; // X√≥a gi√° tr·ªã input
            startQuizBtn.disabled = true;
            questionLimitFeedback.classList.add('d-none');
        }

        // --- Kh·ªüi t·∫°o ·ª©ng d·ª•ng ---
        document.addEventListener('DOMContentLoaded', setupInitialView);

        // --- Logic Ch√≠nh: B·∫Øt ƒê·∫ßu, Hi·ªÉn Th·ªã, Chuy·ªÉn C√¢u ---

        function startQuiz() {
            // 1. Reset tr·∫°ng th√°i
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            answeredCurrentQuestion = false;

            // 2. Ch·ªçn v√† x√°o tr·ªôn c√¢u h·ªèi
            // L·∫•y ng·∫´u nhi√™n 'totalQuestionsToAsk' c√¢u h·ªèi t·ª´ quizData
            let shuffledData = shuffleArray([...quizData]);
            selectedQuestions = shuffledData.slice(0, totalQuestionsToAsk);

            // 3. C·∫≠p nh·∫≠t th√¥ng tin hi·ªÉn th·ªã
            totalQuestionsDisplay.textContent = totalQuestionsToAsk;
            
            // 4. Chuy·ªÉn sang giao di·ªán Quiz
            showView('quiz');
            loadQuestion(currentQuestionIndex);
        }

        function loadQuestion(index) {
            if (index >= selectedQuestions.length) {
                // ƒê√£ h·∫øt c√¢u h·ªèi
                showResultView();
                return;
            }

            // Reset tr·∫°ng th√°i c√¢u h·ªèi hi·ªán t·∫°i
            answeredCurrentQuestion = false;
            nextQuestionBtn.disabled = true;
            feedbackDisplay.classList.add('d-none');
            feedbackDisplay.innerHTML = '';
            answerOptionsContainer.innerHTML = ''; // X√≥a ƒë√°p √°n c≈©

            const currentQ = selectedQuestions[index];

            // C·∫≠p nh·∫≠t ch·ªâ s·ªë c√¢u h·ªèi v√† ti·∫øn tr√¨nh
            currentQuestionNumberDisplay.textContent = index + 1;
            updateProgressBar(index);

            // Hi·ªÉn th·ªã c√¢u h·ªèi
            questionTextDisplay.textContent = currentQ.question;

            // Hi·ªÉn th·ªã c√°c ƒë√°p √°n
            // Tr·ªôn ƒë√°p √°n ƒë·ªÉ tƒÉng t√≠nh ng·∫´u nhi√™n
            const shuffledOptions = shuffleArray([...currentQ.options]); 
            const optionLabels = ["A", "B", "C", "D"];

            shuffledOptions.forEach((option, i) => {
                const optionLabel = optionLabels[i];
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'btn btn-outline-secondary text-start p-3 fw-bold quiz-option-btn';
                button.dataset.answer = option;
                button.innerHTML = `<span class="me-3 badge bg-secondary">${optionLabel}</span> ${option}`;
                button.addEventListener('click', handleAnswerSelection);
                answerOptionsContainer.appendChild(button);
            });
        }

        function updateProgressBar(index) {
            const percentage = (index / totalQuestionsToAsk) * 100;
            quizProgressBar.style.width = `${percentage}%`;
            quizProgressBar.setAttribute('aria-valuenow', percentage);
            progressText.textContent = `${Math.round(percentage)}%`;

            // C·∫≠p nh·∫≠t thanh ti·∫øn tr√¨nh cho c√¢u h·ªèi cu·ªëi c√πng sau khi tr·∫£ l·ªùi
            if (index === totalQuestionsToAsk) {
                quizProgressBar.style.width = '100%';
                quizProgressBar.setAttribute('aria-valuenow', 100);
                progressText.textContent = '100%';
            }
        }

        function handleAnswerSelection(event) {
            if (answeredCurrentQuestion) return; // NgƒÉn ch·∫∑n ch·ªçn l·∫°i

            const selectedButton = event.currentTarget;
            const selectedAnswer = selectedButton.dataset.answer;
            const currentQ = selectedQuestions[currentQuestionIndex];
            const correctAnswer = currentQ.answer;

            answeredCurrentQuestion = true;
            nextQuestionBtn.disabled = false; // B·∫≠t n√∫t Ti·∫øp T·ª•c

            let isCorrect = (selectedAnswer === correctAnswer);
            
            // 1. L∆∞u k·∫øt qu·∫£
            userAnswers.push({
                question: currentQ.question,
                yourAnswer: selectedAnswer,
                correctAnswer: correctAnswer,
                isCorrect: isCorrect
            });

            // 2. Ph·∫£n h·ªìi v√† t√¥ m√†u ƒë√°p √°n
            const allOptionButtons = $$('.quiz-option-btn');
            allOptionButtons.forEach(btn => {
                btn.disabled = true; // V√¥ hi·ªáu h√≥a t·∫•t c·∫£ c√°c n√∫t
                const answer = btn.dataset.answer;

                if (answer === correctAnswer) {
                    // T√¥ xanh ƒë√°p √°n ƒë√∫ng
                    btn.classList.remove('btn-outline-secondary');
                    btn.classList.add('btn-success', 'text-white');
                    btn.querySelector('.badge').classList.remove('bg-secondary');
                    btn.querySelector('.badge').classList.add('bg-light', 'text-success');
                }
                
                if (!isCorrect && answer === selectedAnswer) {
                    // T√¥ ƒë·ªè ƒë√°p √°n sai (n·∫øu ch·ªçn sai)
                    btn.classList.remove('btn-outline-secondary');
                    btn.classList.add('btn-danger', 'text-white');
                    btn.querySelector('.badge').classList.remove('bg-secondary');
                    btn.querySelector('.badge').classList.add('bg-light', 'text-danger');
                }
            });

            // 3. Hi·ªÉn th·ªã feedback
            feedbackDisplay.classList.remove('d-none');
            if (isCorrect) {
                score++;
                feedbackDisplay.className = 'mt-4 p-3 rounded-3 text-center alert alert-success fw-bold';
                feedbackDisplay.innerHTML = '‚úÖ Ch√≠nh x√°c! Tuy·ªát v·ªùi!';
            } else {
                feedbackDisplay.className = 'mt-4 p-3 rounded-3 text-center alert alert-danger fw-bold';
                feedbackDisplay.innerHTML = `‚ùå Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: <strong>${correctAnswer}</strong>.`;
            }

            // 4. C·∫≠p nh·∫≠t ch·ªØ n√∫t Ti·∫øp T·ª•c
            if (currentQuestionIndex === totalQuestionsToAsk - 1) {
                nextQuestionBtn.textContent = 'Xem K·∫øt Qu·∫£ T·ªïng H·ª£p üèÜ';
            } else {
                nextQuestionBtn.textContent = 'Ti·∫øp T·ª•c ‚û°Ô∏è';
            }
        }

        nextQuestionBtn.addEventListener('click', () => {
            if (!answeredCurrentQuestion) return;
            currentQuestionIndex++;
            loadQuestion(currentQuestionIndex);
        });

        // --- Giao Di·ªán 3: K·∫øt Qu·∫£ ---

        function showResultView() {
            showView('result');
            
            // C·∫≠p nh·∫≠t thanh ti·∫øn tr√¨nh l·∫ßn cu·ªëi
            updateProgressBar(totalQuestionsToAsk);

            $('#correct-answers-count').textContent = score;
            $('#total-questions-result').textContent = totalQuestionsToAsk;
            $('#final-score').textContent = `${score}/${totalQuestionsToAsk}`;

            const resultTableBody = $('#result-table tbody');
            resultTableBody.innerHTML = ''; // X√≥a k·∫øt qu·∫£ c≈©

            userAnswers.forEach((item, index) => {
                const row = resultTableBody.insertRow();
                const resultClass = item.isCorrect ? 'table-success' : 'table-danger';
                row.className = resultClass;

                row.insertCell().textContent = index + 1; // # C√¢u
                row.insertCell().textContent = item.question; // C√¢u H·ªèi
                
                // ƒê√°p √Ån C·ªßa B·∫°n
                const yourAnswerCell = row.insertCell();
                yourAnswerCell.innerHTML = item.isCorrect 
                    ? `<strong>${item.yourAnswer}</strong>`
                    : `‚ùå <strong class="text-danger">${item.yourAnswer}</strong>`;

                // ƒê√°p √Ån ƒê√∫ng
                row.insertCell().innerHTML = `<strong>${item.correctAnswer}</strong>`;

                // K·∫øt Qu·∫£
                row.insertCell().innerHTML = item.isCorrect ? '‚úÖ ƒê√∫ng' : '‚ùå Sai';
            });
        }
        
        // --- Chuy·ªÉn ƒê·ªïi Giao Di·ªán ---

        function showView(view) {
            setupView.classList.add('d-none');
            quizView.classList.add('d-none');
            resultView.classList.add('d-none');

            if (view === 'setup') {
                setupView.classList.remove('d-none');
            } else if (view === 'quiz') {
                quizView.classList.remove('d-none');
            } else if (view === 'result') {
                resultView.classList.remove('d-none');
            }
        }
        
        function resetQuiz() {
            // Quay l·∫°i tr·∫°ng th√°i ban ƒë·∫ßu
            showView('setup');
            numQuestionsSelect.value = "";
            startQuizBtn.disabled = true;
        }


        // --- Kh·ªüi t·∫°o ·ª©ng d·ª•ng ---
        document.addEventListener('DOMContentLoaded', setupInitialView);

    </script>
</body>
</html>